// Study Buddy Mobile Application - Frontend JavaScript
// Modern vanilla JavaScript with mobile-first approach

class StudyBuddyApp {
  constructor() {\n    this.currentUser = null;\n    this.subjects = [];\n    this.userProgress = {};\n    this.init();\n  }\n\n  // Initialize the application\n  async init() {\n    console.log('ðŸš€ Study Buddy App Initializing...');\n    \n    // Set up event listeners\n    this.setupEventListeners();\n    \n    // Load initial data\n    await this.loadSubjects();\n    \n    // Initialize UI components\n    this.initializeUI();\n    \n    console.log('âœ… Study Buddy App Ready!');\n  }\n\n  // Set up event listeners\n  setupEventListeners() {\n    // Handle mobile navigation\n    document.addEventListener('DOMContentLoaded', () => {\n      this.handleMobileNavigation();\n    });\n\n    // Handle window resize for responsive design\n    window.addEventListener('resize', this.debounce(() => {\n      this.handleResize();\n    }, 250));\n\n    // Handle offline/online status\n    window.addEventListener('online', () => this.handleOnlineStatus(true));\n    window.addEventListener('offline', () => this.handleOnlineStatus(false));\n\n    // Handle visibility change (app focus/blur)\n    document.addEventListener('visibilitychange', () => {\n      if (!document.hidden) {\n        this.refreshData();\n      }\n    });\n  }\n\n  // Load subjects from API\n  async loadSubjects() {\n    try {\n      const response = await axios.get('/api/subjects');\n      if (response.data.success) {\n        this.subjects = response.data.subjects;\n        this.renderSubjects();\n      }\n    } catch (error) {\n      console.error('Failed to load subjects:', error);\n      this.showNotification('Failed to load subjects', 'error');\n    }\n  }\n\n  // Render subjects grid\n  renderSubjects() {\n    const subjectsGrid = document.getElementById('subjects-grid');\n    if (!subjectsGrid || !this.subjects.length) return;\n\n    subjectsGrid.innerHTML = this.subjects.map(subject => `\n      <div class=\"subject-card\" \n           style=\"--subject-color: ${subject.color}; --subject-color-dark: ${this.darkenColor(subject.color)}\" \n           onclick=\"app.openSubject('${subject.id}')\">\n        <div class=\"flex items-center justify-between mb-2\">\n          <span class=\"text-2xl\">${subject.icon}</span>\n          <span class=\"text-xs opacity-75\">${subject.code}</span>\n        </div>\n        <div>\n          <h4 class=\"font-semibold text-lg leading-tight\">${subject.name}</h4>\n          <p class=\"text-xs opacity-90 mt-1 line-clamp-2\">${subject.description || ''}</p>\n        </div>\n        <div class=\"mt-3\">\n          <div class=\"progress-bar bg-white bg-opacity-20\">\n            <div class=\"progress-fill bg-white\" style=\"width: ${this.getSubjectProgress(subject.id)}%\"></div>\n          </div>\n          <div class=\"text-xs mt-1 opacity-90\">${this.getSubjectProgress(subject.id)}% Complete</div>\n        </div>\n      </div>\n    `).join('');\n\n    // Add animation\n    this.animateElements(subjectsGrid.children);\n  }\n\n  // Open subject page\n  openSubject(subjectId) {\n    const subject = this.subjects.find(s => s.id == subjectId);\n    if (!subject) return;\n\n    this.showNotification(`Opening ${subject.name}...`, 'success');\n    \n    // For now, just show a modal or navigate to subject page\n    // In a full implementation, this would navigate to a subject detail page\n    console.log(`Opening subject: ${subject.name}`);\n  }\n\n  // Get subject progress (mock data for now)\n  getSubjectProgress(subjectId) {\n    const progressMap = {\n      '1': 75, // Math\n      '2': 60, // English\n      '3': 45, // Science\n      '4': 30, // History\n      '5': 20, // Geography\n      '6': 0,  // Chemistry\n      '7': 0,  // Physics\n      '8': 0   // Biology\n    };\n    return progressMap[subjectId] || 0;\n  }\n\n  // Initialize UI components\n  initializeUI() {\n    // Initialize mobile navigation\n    this.initMobileNavigation();\n    \n    // Initialize tooltips\n    this.initTooltips();\n    \n    // Initialize modals\n    this.initModals();\n    \n    // Add smooth scrolling\n    this.initSmoothScrolling();\n\n    // Add intersection observer for animations\n    this.initScrollAnimations();\n  }\n\n  // Initialize mobile navigation\n  initMobileNavigation() {\n    // Add mobile menu toggle if needed\n    const mobileMenuButton = document.querySelector('[data-mobile-menu-toggle]');\n    if (mobileMenuButton) {\n      mobileMenuButton.addEventListener('click', this.toggleMobileMenu.bind(this));\n    }\n  }\n\n  // Initialize scroll animations\n  initScrollAnimations() {\n    const observer = new IntersectionObserver((entries) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          entry.target.classList.add('fade-in');\n        }\n      });\n    }, {\n      threshold: 0.1,\n      rootMargin: '0px 0px -50px 0px'\n    });\n\n    // Observe all cards and sections\n    document.querySelectorAll('.card, section, .feature-item').forEach(el => {\n      observer.observe(el);\n    });\n  }\n\n  // Initialize smooth scrolling\n  initSmoothScrolling() {\n    document.querySelectorAll('a[href^=\"#\"]').forEach(anchor => {\n      anchor.addEventListener('click', (e) => {\n        e.preventDefault();\n        const target = document.querySelector(anchor.getAttribute('href'));\n        if (target) {\n          target.scrollIntoView({\n            behavior: 'smooth',\n            block: 'start'\n          });\n        }\n      });\n    });\n  }\n\n  // Initialize tooltips\n  initTooltips() {\n    // Simple tooltip implementation\n    document.querySelectorAll('[data-tooltip]').forEach(el => {\n      el.addEventListener('mouseenter', this.showTooltip.bind(this));\n      el.addEventListener('mouseleave', this.hideTooltip.bind(this));\n    });\n  }\n\n  // Initialize modals\n  initModals() {\n    // Modal close buttons\n    document.querySelectorAll('[data-modal-close]').forEach(btn => {\n      btn.addEventListener('click', this.closeModal.bind(this));\n    });\n\n    // Close modal on backdrop click\n    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {\n      backdrop.addEventListener('click', (e) => {\n        if (e.target === backdrop) {\n          this.closeModal();\n        }\n      });\n    });\n  }\n\n  // Show notification\n  showNotification(message, type = 'info') {\n    const notification = document.createElement('div');\n    notification.className = `notification ${type}`;\n    notification.innerHTML = `\n      <div class=\"flex items-start\">\n        <div class=\"flex-shrink-0\">\n          ${this.getNotificationIcon(type)}\n        </div>\n        <div class=\"ml-3 flex-1\">\n          <p class=\"text-sm font-medium text-gray-900\">${message}</p>\n        </div>\n        <div class=\"ml-4 flex-shrink-0\">\n          <button class=\"text-gray-400 hover:text-gray-600\" onclick=\"this.parentElement.parentElement.parentElement.remove()\">\n            <i class=\"fas fa-times\"></i>\n          </button>\n        </div>\n      </div>\n    `;\n\n    document.body.appendChild(notification);\n\n    // Auto remove after 5 seconds\n    setTimeout(() => {\n      if (notification.parentElement) {\n        notification.remove();\n      }\n    }, 5000);\n  }\n\n  // Get notification icon\n  getNotificationIcon(type) {\n    const icons = {\n      success: '<i class=\"fas fa-check-circle text-green-500\"></i>',\n      error: '<i class=\"fas fa-exclamation-circle text-red-500\"></i>',\n      warning: '<i class=\"fas fa-exclamation-triangle text-yellow-500\"></i>',\n      info: '<i class=\"fas fa-info-circle text-blue-500\"></i>'\n    };\n    return icons[type] || icons.info;\n  }\n\n  // Handle mobile navigation\n  handleMobileNavigation() {\n    // Detect swipe gestures for mobile navigation\n    let touchStartX = 0;\n    let touchEndX = 0;\n\n    document.addEventListener('touchstart', e => {\n      touchStartX = e.changedTouches[0].screenX;\n    });\n\n    document.addEventListener('touchend', e => {\n      touchEndX = e.changedTouches[0].screenX;\n      this.handleSwipe();\n    });\n  }\n\n  // Handle swipe gestures\n  handleSwipe() {\n    const swipeThreshold = 100;\n    const swipeDistance = Math.abs(touchEndX - touchStartX);\n\n    if (swipeDistance > swipeThreshold) {\n      if (touchEndX < touchStartX) {\n        // Swipe left\n        this.handleSwipeLeft();\n      } else {\n        // Swipe right\n        this.handleSwipeRight();\n      }\n    }\n  }\n\n  // Handle window resize\n  handleResize() {\n    // Adjust layout for different screen sizes\n    const width = window.innerWidth;\n    \n    if (width < 640) {\n      document.body.classList.add('mobile-view');\n    } else {\n      document.body.classList.remove('mobile-view');\n    }\n  }\n\n  // Handle online/offline status\n  handleOnlineStatus(isOnline) {\n    const statusMessage = isOnline ? 'Connection restored' : 'You are offline';\n    const statusType = isOnline ? 'success' : 'warning';\n    \n    this.showNotification(statusMessage, statusType);\n    \n    // Update UI based on connection status\n    if (isOnline) {\n      this.refreshData();\n    }\n  }\n\n  // Refresh data\n  async refreshData() {\n    // Reload subjects and other data\n    await this.loadSubjects();\n  }\n\n  // Animate elements\n  animateElements(elements) {\n    Array.from(elements).forEach((el, index) => {\n      el.style.opacity = '0';\n      el.style.transform = 'translateY(20px)';\n      \n      setTimeout(() => {\n        el.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';\n        el.style.opacity = '1';\n        el.style.transform = 'translateY(0)';\n      }, index * 100);\n    });\n  }\n\n  // Darken color utility\n  darkenColor(color, amount = 20) {\n    const hex = color.replace('#', '');\n    const r = Math.max(0, parseInt(hex.substr(0, 2), 16) - amount);\n    const g = Math.max(0, parseInt(hex.substr(2, 2), 16) - amount);\n    const b = Math.max(0, parseInt(hex.substr(4, 2), 16) - amount);\n    \n    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n  }\n\n  // Debounce utility\n  debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n      const later = () => {\n        clearTimeout(timeout);\n        func(...args);\n      };\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n    };\n  }\n\n  // Show tooltip\n  showTooltip(event) {\n    const tooltip = document.createElement('div');\n    tooltip.className = 'tooltip bg-gray-900 text-white text-xs rounded px-2 py-1 absolute z-50';\n    tooltip.textContent = event.target.getAttribute('data-tooltip');\n    \n    document.body.appendChild(tooltip);\n    \n    const rect = event.target.getBoundingClientRect();\n    tooltip.style.left = `${rect.left + rect.width / 2 - tooltip.offsetWidth / 2}px`;\n    tooltip.style.top = `${rect.top - tooltip.offsetHeight - 5}px`;\n  }\n\n  // Hide tooltip\n  hideTooltip() {\n    const tooltip = document.querySelector('.tooltip');\n    if (tooltip) {\n      tooltip.remove();\n    }\n  }\n\n  // Close modal\n  closeModal() {\n    document.querySelectorAll('.modal').forEach(modal => {\n      modal.classList.add('hidden');\n    });\n  }\n\n  // Toggle mobile menu\n  toggleMobileMenu() {\n    const mobileMenu = document.querySelector('[data-mobile-menu]');\n    if (mobileMenu) {\n      mobileMenu.classList.toggle('hidden');\n    }\n  }\n\n  // Handle swipe left\n  handleSwipeLeft() {\n    console.log('Swiped left');\n    // Implement navigation logic\n  }\n\n  // Handle swipe right\n  handleSwipeRight() {\n    console.log('Swiped right');\n    // Implement navigation logic\n  }\n\n  // Quiz functionality\n  startQuiz(quizId) {\n    console.log(`Starting quiz: ${quizId}`);\n    // Implement quiz logic\n  }\n\n  // Progress tracking\n  updateProgress(contentId, progress) {\n    console.log(`Updating progress for content ${contentId}: ${progress}%`);\n    // Implement progress tracking\n  }\n\n  // Study session tracking\n  startStudySession(contentId) {\n    console.log(`Starting study session for content: ${contentId}`);\n    this.studyStartTime = Date.now();\n  }\n\n  endStudySession(contentId) {\n    if (this.studyStartTime) {\n      const duration = Date.now() - this.studyStartTime;\n      console.log(`Ending study session for content ${contentId}. Duration: ${duration}ms`);\n      // Send to API\n    }\n  }\n}\n\n// Utility functions\nconst utils = {\n  // Format time\n  formatTime(seconds) {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    if (hours > 0) {\n      return `${hours}h ${minutes}m`;\n    } else if (minutes > 0) {\n      return `${minutes}m ${secs}s`;\n    } else {\n      return `${secs}s`;\n    }\n  },\n\n  // Format date\n  formatDate(date) {\n    return dayjs(date).format('MMM DD, YYYY');\n  },\n\n  // Format relative time\n  formatRelativeTime(date) {\n    return dayjs(date).fromNow();\n  },\n\n  // Generate random ID\n  generateId() {\n    return Math.random().toString(36).substr(2, 9);\n  },\n\n  // Validate email\n  validateEmail(email) {\n    const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return re.test(email);\n  },\n\n  // Storage helpers\n  storage: {\n    set(key, value) {\n      try {\n        localStorage.setItem(key, JSON.stringify(value));\n      } catch (e) {\n        console.warn('Failed to save to localStorage:', e);\n      }\n    },\n\n    get(key) {\n      try {\n        const item = localStorage.getItem(key);\n        return item ? JSON.parse(item) : null;\n      } catch (e) {\n        console.warn('Failed to read from localStorage:', e);\n        return null;\n      }\n    },\n\n    remove(key) {\n      try {\n        localStorage.removeItem(key);\n      } catch (e) {\n        console.warn('Failed to remove from localStorage:', e);\n      }\n    }\n  }\n};\n\n// Initialize the app when DOM is ready\nlet app;\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    app = new StudyBuddyApp();\n  });\n} else {\n  app = new StudyBuddyApp();\n}\n\n// Make app globally available\nwindow.StudyBuddy = {\n  app,\n  utils\n};\n\n// Service Worker registration for PWA capabilities\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js')\n      .then(registration => {\n        console.log('SW registered: ', registration);\n      })\n      .catch(registrationError => {\n        console.log('SW registration failed: ', registrationError);\n      });\n  });\n}